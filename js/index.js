// 爱
// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
// 你
// Get the modal
var modal2 = document.getElementById("myModal2");

// Get the button that opens the modal
var btn2 = document.getElementById("myBtn2");

// Get the <span> element that closes the modal
var span2 = document.getElementsByClassName("close2")[0];

// When the user clicks on the button, open the modal
btn2.onclick = function() {
  modal2.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span2.onclick = function() {
  modal2.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event2) {
  if (event2.target == modal2) {
    modal2.style.display = "none";
  }
}
// 我
// Get the modal
var modal3 = document.getElementById("myModal3");

// Get the button that opens the modal
var btn3 = document.getElementById("myBtn3");

// Get the <span> element that closes the modal
var span3 = document.getElementsByClassName("close3")[0];

// When the user clicks on the button, open the modal
btn3.onclick = function() {
  modal3.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span3.onclick = function() {
  modal3.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event3) {
  if (event3.target == modal3) {
    modal3.style.display = "none";
  }
}
// 人们
// Get the modal
var modal4 = document.getElementById("myModal4");

// Get the button that opens the modal
var btn4 = document.getElementById("myBtn4");

// Get the <span> element that closes the modal
var span4 = document.getElementsByClassName("close4")[0];

// When the user clicks on the button, open the modal
btn4.onclick = function() {
  modal4.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span4.onclick = function() {
  modal4.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event4) {
  if (event4.target == modal4) {
    modal4.style.display = "none";
  }
}
// 走路
// Get the modal
var modal5 = document.getElementById("myModal5");

// Get the button that opens the modal
var btn5 = document.getElementById("myBtn5");

// Get the <span> element that closes the modal
var span5 = document.getElementsByClassName("close5")[0];

// When the user clicks on the button, open the modal
btn5.onclick = function() {
  modal5.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span5.onclick = function() {
  modal5.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event5) {
  if (event5.target == modal5) {
    modal5.style.display = "none";
  }
}
// 浪
// Get the modal
var modal6 = document.getElementById("myModal6");

// Get the button that opens the modal
var btn6 = document.getElementById("myBtn6");

// Get the <span> element that closes the modal
var span6 = document.getElementsByClassName("close6")[0];

// When the user clicks on the button, open the modal
btn6.onclick = function() {
  modal6.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span6.onclick = function() {
  modal6.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event6) {
  if (event6.target == modal6) {
    modal6.style.display = "none";
  }
}

// 阳光
// Get the modal
var modal7 = document.getElementById("myModal7");

// Get the button that opens the modal
var btn7 = document.getElementById("myBtn7");

// Get the <span> element that closes the modal
var span7 = document.getElementsByClassName("close7")[0];

// When the user clicks on the button, open the modal
btn7.onclick = function() {
  modal7.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span7.onclick = function() {
  modal7.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event7) {
  if (event7.target == modal7) {
    modal7.style.display = "none";
  }
}

// 胡思乱想
// Get the modal
var modal8 = document.getElementById("myModal8");

// Get the button that opens the modal
var btn8 = document.getElementById("myBtn8");

// Get the <span> element that closes the modal
var span8 = document.getElementsByClassName("close8")[0];

// When the user clicks on the button, open the modal
btn8.onclick = function() {
  modal8.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span8.onclick = function() {
  modal8.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event8) {
  if (event8.target == modal8) {
    modal8.style.display = "none";
  }
}

// 夜空
// Get the modal
var modal9 = document.getElementById("myModal9");

// Get the button that opens the modal
var btn9 = document.getElementById("myBtn9");

// Get the <span> element that closes the modal
var span9 = document.getElementsByClassName("close9")[0];

// When the user clicks on the button, open the modal
btn9.onclick = function() {
  modal9.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span9.onclick = function() {
  modal9.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event9) {
  if (event9.target == modal9) {
    modal9.style.display = "none";
  }
}

// 生命
// Get the modal
var modal10 = document.getElementById("myModal10");

// Get the button that opens the modal
var btn10 = document.getElementById("myBtn10");

// Get the <span> element that closes the modal
var span10 = document.getElementsByClassName("close10")[0];

// When the user clicks on the button, open the modal
btn10.onclick = function() {
  modal10.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span10.onclick = function() {
  modal10.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event10) {
  if (event10.target == modal10) {
    modal10.style.display = "none";
  }
}

// 没有
// Get the modal
var modal11 = document.getElementById("myModal11");

// Get the button that opens the modal
var btn11 = document.getElementById("myBtn11");

// Get the <span> element that closes the modal
var span11 = document.getElementsByClassName("close11")[0];

// When the user clicks on the button, open the modal
btn11.onclick = function() {
  modal11.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span11.onclick = function() {
  modal11.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event11) {
  if (event11.target == modal11) {
    modal11.style.display = "none";
  }
}

// 抱怨
// Get the modal
var modal12 = document.getElementById("myModal12");

// Get the button that opens the modal
var btn12 = document.getElementById("myBtn12");

// Get the <span> element that closes the modal
var span12 = document.getElementsByClassName("close12")[0];

// When the user clicks on the button, open the modal
btn12.onclick = function() {
  modal12.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span12.onclick = function() {
  modal12.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event12) {
  if (event12.target == modal12) {
    modal12.style.display = "none";
  }
}

// Entry Animation Script
document.addEventListener('DOMContentLoaded', function() {
  const entryAnimation = document.getElementById('entryAnimation');
  const sunContainer = document.getElementById('sunContainer');
  const poemCountElement = document.getElementById('poemCount');
  const mainContent = document.getElementById('mainContent');
  const poemLinesContainer = document.getElementById('poemLinesContainer');

  // Poem lines with their corresponding category colors
  const poemLines = [
    { text: "无牵无挂，只想把远方的路当家", color: "color-walking" },
    { text: "从波浪中浮起, 是你信里的字字句句", color: "color-water" },
    { text: "人们来来往往走过,好像另外九十九个我在此平行交错", color: "color-people" },
    { text: "让等待你卑躬屈膝的东西，在盛开中死亡。", color: "color-sunshine" },
    { text: "我不能回答 只能行走——行走是真正的美德", color: "color-walking" },
    { text: "把惧怕飞行和爆发的忧心, 贴在你自由的空旷上", color: "color-you" },
    { text: "我的心是D触发器", color: "color-random" },
    { text: "我是一条憔悴的边界，圈起自己的白昼和溏心的梦——", color: "color-me" },
    { text: "你所见的深沉和明亮，皆因你是太阳", color: "color-sunshine" }
  ];

  // Function to randomly select and display poem lines
  function createFloatingPoemLines() {
    // Select at least 10 poem lines (repeat if needed to reach 10)
    const numLines = 10;
    const selectedPoems = [];
    const usedIndices = new Set();
    
    // First, try to get unique poems
    while (selectedPoems.length < numLines && selectedPoems.length < poemLines.length) {
      const randomIndex = Math.floor(Math.random() * poemLines.length);
      if (!usedIndices.has(randomIndex)) {
        usedIndices.add(randomIndex);
        selectedPoems.push(poemLines[randomIndex]);
      }
    }
    
    // If we need more lines, add random selections (allowing repeats)
    while (selectedPoems.length < numLines) {
      const randomIndex = Math.floor(Math.random() * poemLines.length);
      selectedPoems.push(poemLines[randomIndex]);
    }
    
    // Font size options
    const sizeClasses = ['size-small', 'size-medium', 'size-large', 'size-xlarge'];
    
    // Calculate spaced vertical positions to prevent overlap
    const screenHeight = window.innerHeight;
    const minSpacing = 80; // Reduced spacing for more lines
    const availableHeight = screenHeight * 0.75; // Use 75% of screen (10% to 85%)
    const spacing = availableHeight / (numLines + 1);
    const startPosition = 10; // Start at 10% from top
    
    // Create and display each poem line
    selectedPoems.forEach((poem, index) => {
      const poemElement = document.createElement('div');
      
      // Randomly assign font size
      const sizeClass = sizeClasses[Math.floor(Math.random() * sizeClasses.length)];
      
      poemElement.className = `floating-poem-line ${poem.color} ${sizeClass}`;
      poemElement.textContent = poem.text;
      
      // Calculate non-overlapping vertical position with slight randomness
      const baseTopPosition = startPosition + (index + 1) * (spacing / screenHeight * 100);
      const randomOffset = (Math.random() - 0.5) * 2; // -1 to +1% variation
      const topPosition = baseTopPosition + randomOffset;
      poemElement.style.top = `${Math.max(5, Math.min(90, topPosition))}%`;
      
      // Stagger delays to create a flowing effect
      const delay = index * 0.3 + Math.random() * 0.8;
      const duration = 18 + Math.random() * 4; // 18-22 seconds
      poemElement.style.animationDelay = `${delay}s`;
      poemElement.style.animationDuration = `${duration}s`;
      
      poemLinesContainer.appendChild(poemElement);
    });
  }

  // Count total poems dynamically
  function countPoems() {
    const poemLinks = document.querySelectorAll('a[href^="poems/"]');
    return poemLinks.length;
  }

  // Animate number counting up
  function animateCount(targetNumber, element, duration = 1000) {
    const startTime = performance.now();
    const startNumber = 0;
    
    function updateCount(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // Easing function for smooth animation
      const easeOutCubic = 1 - Math.pow(1 - progress, 3);
      const currentNumber = Math.floor(startNumber + (targetNumber - startNumber) * easeOutCubic);
      
      element.textContent = currentNumber;
      
      if (progress < 1) {
        requestAnimationFrame(updateCount);
      } else {
        element.textContent = targetNumber;
      }
    }
    
    requestAnimationFrame(updateCount);
  }

  // Start the animation sequence
  function startEntryAnimation() {
    const totalPoems = countPoems();
    
    // Calculate when texts pass halfway point
    // Texts start at -400px, move to center (50vw) then continue
    // Average delay: ~1.5s, average duration: ~20s
    // Halfway point reached at: delay + (duration/2) ≈ 1.5 + 10 = ~11.5s
    // Use 12s to ensure center is clear and texts have passed midway
    const halfwayPoint = 12000; // 12 seconds
    
    // Show sun after texts pass halfway point, leaving center clear
    setTimeout(() => {
      // Animate the count
      animateCount(totalPoems, poemCountElement, 800);
    }, halfwayPoint);
    
    // After showing sun for 4 seconds, hide it
    setTimeout(() => {
      sunContainer.classList.add('hide-sun');
    }, halfwayPoint + 4000);
    
    // Hide the entire animation overlay and show main content
    setTimeout(() => {
      entryAnimation.classList.add('hide');
      mainContent.classList.remove('main-content-hidden');
      mainContent.classList.add('main-content-visible');
      
      // Remove the overlay from DOM after fade out
      setTimeout(() => {
        entryAnimation.style.display = 'none';
      }, 1000);
    }, halfwayPoint + 5000);
  }

  // Check if this is the first visit (using sessionStorage)
  if (!sessionStorage.getItem('animationShown')) {
    document.body.classList.add('animation-active');
    createFloatingPoemLines(); // Create floating poem lines
    startEntryAnimation();
    sessionStorage.setItem('animationShown', 'true');
    
    // Remove body class after animation
    setTimeout(() => {
      document.body.classList.remove('animation-active');
    }, 17000); // halfwayPoint + 5000
  } else {
    // Skip animation on subsequent visits
    entryAnimation.style.display = 'none';
    mainContent.classList.remove('main-content-hidden');
    mainContent.classList.add('main-content-visible');
  }
});